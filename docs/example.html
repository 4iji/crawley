

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Pypi Example &mdash; crawley v0.0.6 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="crawley v0.0.6 documentation" href="index.html" />
    <link rel="next" title="Settings File" href="settings.html" />
    <link rel="prev" title="Crawley’s Documentation" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings File"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Crawley’s Documentation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">crawley v0.0.6 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="pypi-example">
<h1>Pypi Example<a class="headerlink" href="#pypi-example" title="Permalink to this headline">¶</a></h1>
<p>Lets make a scraper that extract data from the pypi&#8217;s front page</p>
<p><a class="reference external" href="http://pypi.python.org/pypi">http://pypi.python.org/pypi</a></p>
<p>Supose that we want extract data from the packages table and
store it in a database.</p>
<p>First at all we need to start a new crawley&#8217;s project. In this case
it will be called pypi_packages.</p>
<div class="highlight-bash"><div class="highlight"><pre>crawley startproject pypi_packages
<span class="nb">cd </span>pypi_packages
</pre></div>
</div>
<p>Then, inside the pypi_packages there will a settings.py file and another
directory containing a crawlers.py file and a models.py file.</p>
<p>Lets start defining the models.py wich is very simple in this case.</p>
<div class="section" id="models">
<h2>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">crawley.persistance</span> <span class="kn">import</span> <span class="n">Entity</span><span class="p">,</span> <span class="n">UrlEntity</span><span class="p">,</span> <span class="n">Field</span><span class="p">,</span> <span class="n">Unicode</span>

<span class="k">class</span> <span class="nc">Package</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>

    <span class="c">#add your table fields here</span>
    <span class="n">updated</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">package</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">Unicode</span><span class="p">(</span><span class="mi">255</span><span class="p">))</span>
</pre></div>
</div>
<p>As you can see, we just need a simple Package table that matches the data
we want to extract.</p>
<p>Ok, now is time to code. Lets make the scraper. It must be located inside
the crawlers.py file</p>
</div>
<div class="section" id="crawlers">
<h2>Crawlers<a class="headerlink" href="#crawlers" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">crawley.crawlers</span> <span class="kn">import</span> <span class="n">BaseCrawler</span>
<span class="kn">from</span> <span class="nn">crawley.scrapers</span> <span class="kn">import</span> <span class="n">BaseScraper</span>
<span class="kn">from</span> <span class="nn">crawley.extractors</span> <span class="kn">import</span> <span class="n">XPathExtractor</span>
<span class="kn">from</span> <span class="nn">models</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">class</span> <span class="nc">pypiScraper</span><span class="p">(</span><span class="n">BaseScraper</span><span class="p">):</span>

    <span class="c">#specify the urls that can be scraped by this class</span>
    <span class="n">matching_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;%&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">scrape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">):</span>

        <span class="c">#getting the html table</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">html</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s">&quot;/html/body/div[5]/div/div/div[3]/table&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c">#for rows 1 to n-1</span>
        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">table</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>

            <span class="c">#obtaining the searched html inside the rows</span>
            <span class="n">td_updated</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">td_package</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">package_link</span> <span class="o">=</span> <span class="n">td_package</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">td_description</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="c">#storing data in Packages table</span>
            <span class="n">Package</span><span class="p">(</span><span class="n">updated</span><span class="o">=</span><span class="n">td_updated</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">package</span><span class="o">=</span><span class="n">package_link</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="n">td_description</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pypiCrawler</span><span class="p">(</span><span class="n">BaseCrawler</span><span class="p">):</span>

    <span class="c">#add your starting urls here</span>
    <span class="n">start_urls</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;http://pypi.python.org/pypi&quot;</span><span class="p">]</span>

    <span class="c">#add your scraper classes here</span>
    <span class="n">scrapers</span> <span class="o">=</span> <span class="p">[</span><span class="n">pypiScraper</span><span class="p">]</span>

    <span class="c">#specify you maximum crawling depth level</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c">#select your favourite HTML parsing tool</span>
    <span class="n">extractor</span> <span class="o">=</span> <span class="n">XPathExtractor</span>
</pre></div>
</div>
<p>The interesting part of this is the scrape method defined inside the
pypiScraper class. It uses Xpath in order to obtain the parsed html
and then stores the extracted data in the Packages table.</p>
<p>At this time we have finished our work. Very simple. Isn&#8217;t it?</p>
</div>
<div class="section" id="run-crawley">
<h2>Run crawley<a class="headerlink" href="#run-crawley" title="Permalink to this headline">¶</a></h2>
<p>Finally, just run the crawler (Ensure you are in the same directory where the
settings.py file is, in other case you can specify your settings directory
with &#8211;settings=path/to/your/settings.py)</p>
<div class="highlight-bash"><div class="highlight"><pre>~<span class="nv">$ </span>crawley run
</pre></div>
</div>
<p>And we are done. Check the results in your database!</p>
</div>
<div class="section" id="downloading-the-code">
<h2>Downloading the Code<a class="headerlink" href="#downloading-the-code" title="Permalink to this headline">¶</a></h2>
<p>The entire code is located in the crawley&#8217;s official repository at:</p>
<p><a class="reference external" href="https://github.com/jmg/crawley/tree/master/examples/pypi_packages">https://github.com/jmg/crawley/tree/master/examples/pypi_packages</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Pypi Example</a><ul>
<li><a class="reference internal" href="#models">Models</a></li>
<li><a class="reference internal" href="#crawlers">Crawlers</a></li>
<li><a class="reference internal" href="#run-crawley">Run crawley</a></li>
<li><a class="reference internal" href="#downloading-the-code">Downloading the Code</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Crawley&#8217;s Documentation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="settings.html"
                        title="next chapter">Settings File</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/example.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="settings.html" title="Settings File"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Crawley’s Documentation"
             >previous</a> |</li>
        <li><a href="index.html">crawley v0.0.6 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, crawley developers.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>